<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
</head>
<body>
    <div class="container mt-4">
        <h1>Prueba de Funcionalidades de Admin</h1>
        
        <div class="mb-3">
            <button class="btn btn-primary" onclick="testLogin()">Iniciar como Admin</button>
            <button class="btn btn-success" onclick="loadAdminReservations()">Cargar Reservas</button>
        </div>
        
        <div class="table-responsive mt-4">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Cliente</th>
                        <th>Email</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Mesa</th>
                        <th>Comensales</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="testReservationsTable"></tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'http://localhost:5000/api';
        let authToken = null;
        let currentUser = null;

        function showToast(message, type = 'info') {
            alert(`${type.toUpperCase()}: ${message}`);
        }

        async function testLogin() {
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        email: 'admin@restaurante.com', 
                        password: 'admin123' 
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    currentUser = data.user;
                    showToast('Login exitoso como ' + currentUser.nombre, 'success');
                    console.log('Token obtenido:', authToken);
                } else {
                    showToast(data.error || 'Error de autenticación', 'danger');
                }
            } catch (error) {
                console.error('Error en login:', error);
                showToast('Error de conexión', 'danger');
            }
        }

        async function loadAdminReservations() {
            if (!authToken) {
                showToast('Debe iniciar sesión primero', 'warning');
                return;
            }

            try {
                console.log('Cargando reservas con token:', authToken);
                
                const response = await fetch(`${API_BASE}/admin/reservas`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                console.log('Status respuesta:', response.status);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Error:', errorData);
                    showToast(errorData.error || 'Error al cargar reservas', 'danger');
                    return;
                }
                
                const reservations = await response.json();
                console.log('Reservas obtenidas:', reservations);
                
                const tbody = document.getElementById('testReservationsTable');
                tbody.innerHTML = '';
                
                if (!reservations || reservations.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="9" class="text-center">No hay reservas registradas</td></tr>';
                    return;
                }
                
                reservations.forEach(reservation => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${reservation.id}</td>
                        <td>${reservation.cliente_nombre}</td>
                        <td>${reservation.email}</td>
                        <td>${reservation.fecha}</td>
                        <td>${reservation.hora}</td>
                        <td>${reservation.mesa_numero}</td>
                        <td>${reservation.numero_comensales}</td>
                        <td><span class="badge bg-primary">${reservation.estado}</span></td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editTestReservation(${reservation.id})" title="Editar">
                                <i class="bi bi-pencil"></i> Editar
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTestReservation(${reservation.id})" title="Eliminar">
                                <i class="bi bi-trash"></i> Eliminar
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                showToast('Reservas cargadas correctamente', 'success');
            } catch (error) {
                console.error('Error al cargar reservas:', error);
                showToast('Error de conexión: ' + error.message, 'danger');
            }
        }

        function editTestReservation(id) {
            console.log('Editando reserva:', id);
            showToast('Función editar reservas ID: ' + id, 'info');
        }

        function deleteTestReservation(id) {
            if (confirm('¿Está seguro de eliminar la reserva ' + id + '?')) {
                console.log('Eliminando reserva:', id);
                showToast('Función eliminar reservas ID: ' + id, 'info');
            }
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
    </script>
</body>
</html>