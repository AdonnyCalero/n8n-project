<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Carga de Datos en Modal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
</head>
<body>
    <div class="container mt-4">
        <h1>Prueba de Carga de Datos en Modal de Edición</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">Simular Datos de Reserva</div>
                    <div class="card-body">
                        <h5>Datos Simulados (como vienen del backend):</h5>
                        <div id="simulationData" class="border p-3 bg-light" style="font-family: monospace; font-size: 12px;">
                            Esperando simulación...
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-success" onclick="simulateRealData()">Simular Datos Reales</button>
                            <button class="btn btn-info" onclick="simulateBadData()">Simular Datos con Problemas</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">Modal de Prueba</div>
                    <div class="card-body">
                        <!-- Modal de prueba -->
                        <div class="modal fade" id="testEditModal" tabindex="-1" aria-labelledby="testEditModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="testEditModalLabel">Editar Reserva (Prueba)</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <!-- Área de mensajes de error -->
                                        <div id="testEditError" class="alert alert-danger" style="display: none;"></div>
                                        
                                        <form id="testEditForm">
                                            <input type="hidden" id="testEditReservationId">
                                            
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="testEditFecha" class="form-label">Fecha</label>
                                                    <input type="date" class="form-control" id="testEditFecha">
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="testEditHora" class="form-label">Hora</label>
                                                    <input type="time" class="form-control" id="testEditHora">
                                                </div>
                                            </div>
                                            
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="testEditComensales" class="form-label">Número de comensales</label>
                                                    <select class="form-select" id="testEditComensales">
                                                        <option value="1">1 persona</option>
                                                        <option value="2">2 personas</option>
                                                        <option value="3">3 personas</option>
                                                        <option value="4">4 personas</option>
                                                        <option value="5">5 personas</option>
                                                        <option value="6">6 personas</option>
                                                        <option value="7">7 personas</option>
                                                        <option value="8">8 personas</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="testEditEstado" class="form-label">Estado</label>
                                                    <select class="form-select" id="testEditEstado">
                                                        <option value="pendiente">Pendiente</option>
                                                        <option value="confirmada">Confirmada</option>
                                                        <option value="cancelada">Cancelada</option>
                                                        <option value="completada">Completada</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="mb-3">
                                                <label for="testEditObservaciones" class="form-label">Observaciones</label>
                                                <textarea class="form-control" id="testEditObservaciones" rows="3"></textarea>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                        <button type="button" class="btn btn-primary" onclick="verifyData()">Verificar Datos</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#testEditModal">
                            Abrir Modal de Prueba
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <div class="card">
                <div class="card-header bg-info text-white">Verificación</div>
                <div class="card-body">
                    <div id="verificationResults" class="border p-3 bg-light" style="font-family: monospace; font-size: 12px;">
                        Esperando verificación...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Simulación de datos como vienen del backend
        const backendReservationExample = {
            "actualizada_en": "2026-01-31 13:53:09",
            "cliente_nombre": "Test User",
            "creada_en": "2026-01-28 22:13:49",
            "email": "test@example.com",
            "estado": "confirmada",
            "fecha": "2026-01-31 00:00:00",
            "hora": "20:00:00",
            "id": 1,
            "id_mesa": 2,
            "id_usuario": 4,
            "mesa_numero": "M2",
            "numero_comensales": 4,
            "observaciones": "Reserva modificada por admin",
            "zona_nombre": "Terraza"
        };

        const backendReservationBadExample = {
            "id": 999,
            "fecha": null,
            "hora": null,
            "numero_comensales": null,
            "estado": null,
            "observaciones": null
        };

        function simulateRealData() {
            document.getElementById('simulationData').innerHTML = JSON.stringify(backendReservationExample, null, 2);
            
            // Aplicar la misma lógica que usa el sistema
            loadTestData(backendReservationExample);
            
            // Abrir el modal
            const modal = new bootstrap.Modal(document.getElementById('testEditModal'));
            modal.show();
        }

        function simulateBadData() {
            document.getElementById('simulationData').innerHTML = JSON.stringify(backendReservationBadExample, null, 2);
            
            // Aplicar la misma lógica que usa el sistema
            loadTestData(backendReservationBadExample);
            
            // Abrir el modal
            const modal = new bootstrap.Modal(document.getElementById('testEditModal'));
            modal.show();
        }

        function loadTestData(reservation) {
            console.log('Cargando datos de prueba:', reservation);
            
            // Limpiar errores previos
            document.getElementById('testEditError').style.display = 'none';
            
            // Aplicar la misma lógica de formateo que usa el sistema
            document.getElementById('testEditReservationId').value = reservation.id;
            
            // Formatear fecha: tomar solo la parte YYYY-MM-DD
            if (reservation.fecha) {
                const fechaFormateada = reservation.fecha.split(' ')[0];
                document.getElementById('testEditFecha').value = fechaFormateada;
                console.log('Fecha original:', reservation.fecha, '→ Formateada:', fechaFormateada);
            }
            
            // Formatear hora: tomar solo HH:MM
            if (reservation.hora) {
                const horaFormateada = reservation.hora.substring(0, 5);
                document.getElementById('testEditHora').value = horaFormateada;
                console.log('Hora original:', reservation.hora, '→ Formateada:', horaFormateada);
            }
            
            document.getElementById('testEditComensales').value = reservation.numero_comensales;
            document.getElementById('testEditEstado').value = reservation.estado;
            document.getElementById('testEditObservaciones').value = reservation.observaciones || '';
            
            console.log('Datos cargados en formulario:', {
                id: document.getElementById('testEditReservationId').value,
                fecha: document.getElementById('testEditFecha').value,
                hora: document.getElementById('testEditHora').value,
                comensales: document.getElementById('testEditComensales').value,
                estado: document.getElementById('testEditEstado').value,
                observaciones: document.getElementById('testEditObservaciones').value
            });
        }

        function verifyData() {
            const currentData = {
                id: document.getElementById('testEditReservationId').value,
                fecha: document.getElementById('testEditFecha').value,
                hora: document.getElementById('testEditHora').value,
                comensales: document.getElementById('testEditComensales').value,
                estado: document.getElementById('testEditEstado').value,
                observaciones: document.getElementById('testEditObservaciones').value
            };
            
            const verificationDiv = document.getElementById('verificationResults');
            
            // Verificar cada campo
            let results = [];
            
            if (currentData.id) {
                results.push(`✅ ID cargado: ${currentData.id}`);
            } else {
                results.push(`❌ ID no cargado`);
            }
            
            if (currentData.fecha) {
                results.push(`✅ Fecha cargada: ${currentData.fecha}`);
            } else {
                results.push(`❌ Fecha no cargada`);
            }
            
            if (currentData.hora) {
                results.push(`✅ Hora cargada: ${currentData.hora}`);
            } else {
                results.push(`❌ Hora no cargada`);
            }
            
            if (currentData.comensales) {
                results.push(`✅ Comensales cargados: ${currentData.comensales}`);
            } else {
                results.push(`❌ Comensales no cargados`);
            }
            
            if (currentData.estado) {
                results.push(`✅ Estado cargado: ${currentData.estado}`);
            } else {
                results.push(`❌ Estado no cargado`);
            }
            
            verificationDiv.innerHTML = results.join('\n');
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Página de prueba de carga de datos lista');
        });
    </script>
</body>
</html>